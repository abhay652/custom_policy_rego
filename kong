$ helm repo add kong https://charts.konghq.com
$ helm repo update

# Helm 2
$ helm install kong/kong

# Helm 3
$ helm install kong/kong --generate-name --set ingressController.installCRDs=false


# 1. Install Custom Kong plugin for OPA

curl -H 'Authorization: Bearer rHf304Q-VAkMsIzZyzf3bgepNczSL1Y9UN9W_WMW5PsEiofnNA5xGdMH3-0Z44zU9A68KR_nq-jlGQsjXtRzNW9LS8ofW8E7t0KLdQ' https://lznyt9.svc.styra.com/v1/systems/f8def75058ea4c1d9317bdc3d778d8e2/assets/custom-kong-plugin.yaml | kubectl apply -f -
# 2. Configure Kong plugin for OPA authorization

curl -H 'Authorization: Bearer rHf304Q-VAkMsIzZyzf3bgepNczSL1Y9UN9W_WMW5PsEiofnNA5xGdMH3-0Z44zU9A68KR_nq-jlGQsjXtRzNW9LS8ofW8E7t0KLdQ' https://lznyt9.svc.styra.com/v1/systems/f8def75058ea4c1d9317bdc3d778d8e2/assets/kong-plugin-config.yaml | kubectl apply -f -
# 3. Configure OPA

curl -H 'Authorization: Bearer rHf304Q-VAkMsIzZyzf3bgepNczSL1Y9UN9W_WMW5PsEiofnNA5xGdMH3-0Z44zU9A68KR_nq-jlGQsjXtRzNW9LS8ofW8E7t0KLdQ' https://lznyt9.svc.styra.com/v1/systems/f8def75058ea4c1d9317bdc3d778d8e2/assets/opa-config.yaml | kubectl apply -n kong -f -
# 4. Install Styra Local Plane (SLP)

curl -H 'Authorization: Bearer rHf304Q-VAkMsIzZyzf3bgepNczSL1Y9UN9W_WMW5PsEiofnNA5xGdMH3-0Z44zU9A68KR_nq-jlGQsjXtRzNW9LS8ofW8E7t0KLdQ' https://lznyt9.svc.styra.com/v1/systems/f8def75058ea4c1d9317bdc3d778d8e2/assets/slp-deployment.yaml | kubectl apply -n kong -f -

# Copy command

helm upgrade kong-quickstart kong/kong -n kong -f opa-sidecar-values.yaml

# Copy command

curl -H 'Authorization: Bearer UBlhyAuaDnW-0ctTTFoqTEAu6i39Xqzaa7GPNLFCO7T2oCPorFLEioRwWqaVw1viQLdJDtA9-ubgm4mklV_S' https://x8gy40.svc.styra.com/v1/system-types/template.kong-gateway:1.0/assets/quickstart/sample-app.yaml | kubectl apply -f -

# Copy command

kubectl logs $(kubectl get pods -l app=client-load -o jsonpath='{.items..metadata.name}')
